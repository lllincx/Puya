# 1 PSOC™ Edge MCU 概述

PSOC™ Edge MCU 是一款多核器件，包含两个 CPU（Cortex®-M33 和 Cortex®-M55）、板载非易失性存储以及一系列外设，包括 ADC、UART、SPI、I2C、I3C、PWM、SMIF、加密加速器和其他几个模块。每个器件还包含一个**安全飞地（Secure Enclave，简称 SE）**，其中包括两个额外的 Cortex®-M0+ CPU，以延迟锁步（delayed lock-step）机制运行。

**安全飞地**负责初始安全启动和信任根（Root of Trust）。它还提供一系列安全功能，维护安全密钥的存储，并执行安全密钥管理。与**安全飞地**的通信仅通过 IPC 通道进行。**安全飞地**仅运行经过英飞凌（Infineon）签名的代码。其代码和数据驻留在**安全飞地**内，其他 CPU 或 DMA 通道无法访问。OEM 无法开发代码或将其注入**安全飞地**。在**安全飞地**上运行的**安全飞地**运行时服务（SERT）库可以更新，但更新以及安装更新的模块必须经过英飞凌签名。

另外两个 CPU，CM33 和 CM55，完全可由用户应用程序访问。CM33 支持 Arm® TrustZone，允许同时存在安全编程环境（SPE）和非安全编程环境（NSPE）。虽然使用的是单个 CPU，但可以创建独立的 SPE 和 NSPE 项目。CM55 是最高性能的 CPU，旨在运行开发者的大部分应用程序。CM33 和 CM55 都可以访问大多数相同的外设模块，因此开发者可以挑选由哪两个 CPU（CM33 和 CM55）控制哪些功能和硬件模块。图 1 显示了基本的编程环境，不包括外设。如上所述，用户应用程序只能在 CM33 或 CM55 CPU 上运行。

![image.png|600|600](https://pic.lllincx.cn/20251215111310150.png)

代码可以存储在本地的内部 RRAM 或外部 Flash 器件中。代码执行可以直接在存储代码的非易失性存储器（NVM）位置运行，也可以在运行时移动到不同位置以提高性能。例如，CM55 可以从外部 Flash、内部 RRAM、系统 SRAM（SoCMEM）或 ITCM 执行代码。如果在系统 SRAM（SoCMEM）或 ITCM 中执行，必须作为启动固件的一部分将其复制到该位置。

该系列包含两类器件：EPC 2 和 EPC 4 器件。这些器件符合此处描述的 Edge Protect 类别 2 和 4。EPC 2 和 EPC 4 器件均支持安全启动、安全固件更新服务和安全调试服务。

为了达到 PSOC™ Edge 支持的最高安全级别，建议使用 EPC 4 器件，它包含**安全飞地**运行时服务（SE RT）库，用于提供符合平台安全架构（PSA）标准的信任根（RoT）服务，例如安全加密服务、安全密钥存储、认证等。该器件还支持 Large profile Trusted Firmware-M（TF-M）特性，并符合 DICE 标准。

SE RT 服务库在 EPC 2 器件上不可用，从而释放了内部 RRAM 存储空间供用户应用程序使用。这些器件支持 Trusted Firmware-M（TF-M）Medium profile。在这些器件中，用户无法访问存储在受保护区域中的 DICE 和 ALIAS 私钥，ALIAS 密钥对在器件制造过程中作为 `IAK_LITE` 密钥对复制到 NVM 区域，并可用于 PSA 初始认证。

有关 EPC 2 和 EPC 4 器件支持的特性，请参阅“EPC 2 和 EPC 4 类器件的安全特性”部分。

# 2. 开发易用性 (Ease of development)

## 2.1 设备生命周期阶段 (LCS)

对于产品开发者而言，设备生命周期主要包含三个关键阶段：**开发 (Development)**、**生产 (Production)** 和 **返修 (RMA)**。

### 开发阶段 (Development Stage)

设备出厂时默认处于开发阶段。在此阶段，设备允许进行不限次数的配置（Provision）和编程，以满足最终应用程序开发的需要。设备预置了默认策略，将所有调试端口定义为开启状态，并禁用了代码认证。这种机制允许任何用户在无需了解安全机制或代码签名的情况下，直接对芯片进行编程、评估和调试。

在开发阶段，OEM 可以获取芯片的所有权，并将默认策略替换为自定义策略。开发者可以模拟生产阶段的所有特性，包括锁定 CPU 接入端口（CPU Access Ports）以阻止调试器连接内核。

从代码操作的角度来看，开发阶段与生产阶段的唯一区别在于：**系统接入端口 (SYS_AP) 在开发阶段无法被禁用**。这一强制性机制确保了开发者不会因配置错误而被意外锁定在设备之外，用户随时可以恢复设备配置，甚至将其重置为初始状态。

### 生产阶段 (Production Stage)

当固件准备好量产时，设备可推进至生产阶段。该阶段会锁定设备的所有者，这意味着写入设备用于验证固件的密钥将无法再更改。根据用户需求，调试端口（包括 SYS_AP）可以被全部禁用或保持开启。

典型的部署模式是 OEM 收到来自英飞凌的设备（处于开发阶段）后，在产线配置设备的过程中，一步完成“获取所有权”并“推进至生产阶段”的操作，而无需在开发阶段先进行单独的所有权转移。

> **注意：** 为了符合 PSA Level 4 安全标准，设备在离开 OEM 工厂出货前，必须转换为生产阶段 (Production LCS)，并关闭所有调试端口。或者，必须配置为仅允许经过认证 (Authenticated) 的调试访问。

### 返修阶段 (RMA Stage)

返修阶段仅在确认硬件存在问题，且必须将设备寄回英飞凌进行故障分析 (Failure Analysis) 时使用。图 2 展示了从开发阶段到 RMA 阶段的流转过程。