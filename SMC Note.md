### **SRAM 时序参数详解**

#### **周转时间 (Turn Around Time)**

- **定义**：数据总线从**读取模式切换到写入模式**（或反之）时，控制器必须等待的最短时间
- **作用**：确保 SRAM 停止驱动总线后，控制器才开始驱动总线，避免冲突
- **典型场景**：发生在读操作结束（`OE#`置高）和写操作开始（`WE#`置低）之间

#### **页循环时间 (Page Cycle Time)**

- **定义**：在**页模式访问**中，行地址不变时完成**一次列访问**的最短时间
- **特点**：远小于标准读/写周期时间（省去了行激活时间）
- **应用场景**：突发式顺序数据访问（如缓存行填充）

#### **WE#断言延迟 (WE# Assertion Delay)**

- **定义**：`WE#`有效（低电平）到 SRAM 开始锁存输入数据的时间
- **要求**：数据必须在延迟时间后保持稳定（满足建立/保持时间）

#### **OE#断言延迟 (OE# Assertion Delay)**

- **定义**：`OE#`有效（低电平）到输出数据有效的延迟
- **核心参数**：地址访问时间（`tAA`），决定 SRAM 读取速度

#### **写循环时间 (Write Cycle Time)**

- **定义**：完成完整写操作的最短时间
- **关键子参数**：
  - `tAS`（地址建立时间）
  - `tWP`（写使能脉宽）
  - `tDS`/`tDH`（数据建立/保持时间）

#### **读循环时间 (Read Cycle Time)**

- **定义**：完成完整读操作的最短时间
- **关键子参数**：
  - `tAA`（地址访问时间）
  - `tOH`（地址保持时间）
  - `tOEH`（输出禁止时间）

---

### **NAND 时序参数详解**

#### **WE_n De-assertion 延迟**

- **参数**：`tWH`（WE# High Time）
- **值域**：10–15 ns
- **作用**：确保数据稳定锁存至 NAND 内部缓存

#### **配置状态读时间**

- **总耗时**：<1 μs
- **关键子参数**：
  - `tWB`（命令锁存到 BUSY 有效）：≤100 ns
  - BUSY 持续时间：100–500 ns

#### **配置 ID 读时间**

- **总耗时**：200–500 ns（5 字节 ID）
- **关键子参数**：
  - `tCLS/tALS`（CLE/ALE 建立时间）：≥12 ns
  - `tREA`（RE#到数据就绪）：10–30 ns

#### **BUSY 到 RE_n 时间**

- **核心参数**：`tRB`（BUSY 无效到 RE#有效）
- **值域**：≥50 ns
- **作用**：防止总线冲突

---

### **寄存器说明**

#### **opmode 寄存器**

> 每个支持的芯片都有一个  `opmode`  寄存器的实例。该寄存器是只读的，并且在复位状态下无法读取。  
> 这些寄存器的复位值取决于具体配置。您可以通过硬件连接（tie-off）为每个存储器接口的片选 0 设置存储器位宽，以支持从该芯片启动。所有其他片选的存储器位宽复位值即为所配置的位宽。顶层硬件连接设置地址匹配和地址掩码的复位值。`burst_align`  的复位值为二进制  `001`，所有其他字段复位为  `0`。

#### **地址比较与掩码配置**

> 返回此硬件连接的值。这是用于地址位 [31:24] 的比较值，以确定被选中的芯片。  
> 返回此硬件连接的值。这是用于地址位 [31:24] 的掩码，以确定必须选中的芯片。逻辑 1 表示该位用于比较。
>
> 当配置 SMC 执行同步传输时，这些位控制突发边界拆分：
>
> - `b000`：突发可跨任意地址边界
> - `b001`：在存储器突发边界拆分（32 拍连续）
> - `b010`：在 64 拍边界拆分
> - `b011`：在 128 拍边界拆分
> - `b100`：在 256 拍边界拆分
> - `b101-b111`：保留
>
> **注**：对 NAND 接口这些位保留。

#### **字节通道与突发控制**

> 此位影响字节通道选通输出（BLS）的置位时机：
>
> - `0`：BLS 时序等于片选时序（默认）
> - `1`：BLS 时序等于写使能时序（用于无 BLS 输入的 8 位存储器）
>
> 当置位时：
>
> - 存储器使用地址提前信号（`adv_n`）
> - 存储器使用突发地址提前信号（`baa_n`）
>
> 写操作突发长度选择：
>
> - `b000`：1 拍
> - `b001`：4 拍
> - `b010`：8 拍
> - `b011`：16 拍
> - `b100`：32 拍
> - `b101`：连续传输
> - `b110-b111`：保留
>
> **注**：对 NAND 接口所有上述位均保留。

#### **direct cmd 寄存器**

> 该只写寄存器向外部存储器传递命令，并控制用`set_cycles`和`set_opmode`寄存器的值更新芯片配置寄存器。  
> **复位或低功耗状态下不可写入**。

| 字段        | 功能说明                                                                                  |
| ----------- | ----------------------------------------------------------------------------------------- |
| chip_select | 选择要更新的寄存器组：`b000-b011`=接口 0 片选 1-4；`b100-b111`=接口 1 片选 1-4            |
| cmd_type    | 命令类型：`b00`=UpdateRegs+AXI；`b01`=ModeReg；`b10`=UpdateRegs；`b11`=ModeReg+UpdateRegs |
| set_cre     | ModeReg 命令时映射到`cre`信号：`0`=低电平；`1`=高电平                                     |
| addr        | 根据 cmd_type 映射地址位[19:0]或匹配 wdata[15:0]                                          |

---

### **模块功能**

#### **Format Block**

> 格式转换模块接收来自 AXI 从接口和存储器管理器的访问请求。AR 和 AW 通道的请求采用轮询仲裁，管理器请求具有最高优先级。该模块将 AXI 传输映射为存储器传输，并通过命令 FIFO 传递给存储器接口。

#### **Memory Manager (2.1.4)**

> 跟踪并控制 SMC `aclk`域 FSM 状态，负责：
>
> - 更新`mclk<x>`域的寄存器值
> - 控制向存储器发出的直接命令
> - 通过 APB 接口管理低功耗模式进入/退出
> - 控制 AXI 低功耗接口（详见第 2-27 页）

#### **Memory Interface (2.1.5)**

> 支持 SRAM/NAND 两种接口类型，包含：
>
> - 命令/读数据/写数据 FIFO
> - 专用控制 FSM（SRAM 或 NAND）
> - EBI FSM（控制外部总线交互）
> - 可选 SLC ECC 模块（仅 NAND）  
>    **注**：存储器接口编号`x`=0/1，片选编号`n`=0-3。

#### **Pad Interface (2.1.6)**

> 为数据/控制信号提供寄存 I/O 接口，包含中断生成逻辑。

### 时钟与复位

#### AXI 时钟域

图片中提到 aclk 属于 AXI 时钟域，且仅在 SMC 处于低功耗模式时可停止。这确保了系统在正常运行时的稳定性。

#### 内存时钟域

内存时钟域包括除 aclk 外的所有时钟，需确保 mclk<×>信号与外部内存时钟速度同步。两个内存接口可异步运行，低功耗模式下可停止这些时钟。

#### 同步时钟

同步时钟通过移除同步寄存器减少读写延迟，但受外部内存时钟速度限制，可能影响系统性能。

---

#### 详细报告

以下是图片内容的完整翻译，涵盖了技术文档中关于时钟域的详细描述，确保所有术语和上下文准确无误。

##### 时钟域概述

图片内容首先将时钟分为三个主要时钟域：AXI 时钟域、内存时钟域和同步时钟的相关讨论。以下是逐部分的翻译：

- **AXI 时钟域**  
   aclk 属于该时钟域。仅当静态内存控制器（SMC）处于低功耗模式时，才能停止 aclk。这确保了在正常操作期间时钟的连续性。
- **内存时钟域**  
   除 aclk 外的所有时钟都属于内存时钟域。需确保 mclk<×>信号的时钟频率与外部内存时钟速度一致。mclk<×>n 是 mclk<×>的倒相版本。在实现两个内存接口的配置中，两个内存时钟域还可以彼此异步运行。当 SMC 处于低功耗模式时，可以停止内存时钟域的时钟。
  **注意**  
   <×>表示内存接口 0 或 1。有关时钟之间所需关系的详细信息，请参阅《PrimeCell 静态内存控制器（PL350 系列）集成手册》。
- **同步与异步操作**  
   可以通过固定 SMC 的 async<×>和 msync<×>引脚，使 aclk 和 mclk<×>时钟域相对于彼此同步或异步运行。当使用外部总线接口（EBI，PL220）时，SMC（PL353）和 SMC（PL354）的 mclk0 和 mclk1 时钟域必须以 1:1、n:1 或 1:n 的同步方式运行。
- **同步时钟的优点**  
   同步时钟的优点是通过移除时钟域之间的同步寄存器，可以减少读写延迟。然而，由于时钟之间的整数关系，受外部内存时钟速度对总线频率的限制，系统可能无法获得最大性能。

###### 技术术语解释

在翻译过程中，确保了以下术语的准确性：

- "clock domains" 翻译为 "时钟域"，符合技术文档的用语。
- "low-power mode" 翻译为 "低功耗模式"，与电子工程领域常用表达一致。
- "tie-off" 翻译为 "固定"，在电子设计中指将引脚设置为固定逻辑电平，符合上下文。

| 时钟域类型 | 主要特点                                                   | 操作限制                 |
| ---------- | ---------------------------------------------------------- | ------------------------ |
| AXI 时钟域 | 包含 aclk，仅在低功耗模式下可停止                          | 需确保正常运行时连续性   |
| 内存时钟域 | 包括 mclk<×>和 mclk<×>n，可异步运行，低功耗模式下可停止    | 需与外部内存时钟速度同步 |
| 同步时钟   | 通过移除同步寄存器减少延迟，但受总线频率和内存时钟速度限制 | 需权衡性能与延迟         |

以下是关于“独占访问”的完整中文解释：

---

### 独占访问？

**独占访问**（Exclusive Accesses）是在多主控系统（如遵循 AMBA AXI 协议规范的系统）中用于确保数据一致性的一种机制。特别是在多个主控器（如处理器或设备）访问共享内存或资源时，独占访问能够防止数据竞争，确保数据的完整性。这种机制尤其适用于实现同步原语，如锁或信号量，以协调对共享数据的访问。

#### 关键概念

1. **目的**  
   独占访问允许一个主控器对内存位置执行读-修改-写（read-modify-write）操作，而不会受到其他主控器的干扰。这确保了在操作过程中数据保持一致。

2. **两个阶段**

   - **独占读**（Exclusive Read）：主控器读取一个内存位置，并将其标记为“独占”。这表示它打算稍后修改该位置。系统开始监视该地址。
   - **独占写**（Exclusive Write）：同一个主控器尝试写回该内存位置。只有在自独占读以来没有其他主控器修改该位置时，写操作才会成功。

3. **响应类型**

   - **EXOKAY**：表示独占访问成功（读和写阶段均未受到干扰）。
   - **OKAY**：表示普通访问或独占访问失败（例如，由于干扰而导致独占写失败）。

4. **独占访问监视器**（Exclusive Access Monitors）

   - 这些硬件组件负责跟踪独占访问。每个监视器可以同时监视一个独占访问。
   - 监视器的数量是可配置的，具体取决于系统设计。

5. **失败处理**
   - 如果独占写失败（例如，另一个主控器修改了监视的地址），写操作将被中止，数据掩码（data mask）强制设置为**LOW**，以防止数据被写入。

#### 工作原理：地址监控

为了确保数据一致性，系统会将独占读时监视的地址与来自其他主控器的任何写地址进行比较。这种比较使用**位掩码**（bit mask）来确定监视的位置是否被修改。

- **位掩码生成**

  - 对于一个写事务，识别其访问的字节地址范围（例如，0x104–0x10B）。
  - 找到该范围内变化的最高位（例如，位 3）。
  - 在掩码中，将该位及以下所有位设置为**0**（不比较这些位）。
  - 将所有更高的稳定位设置为**1**（比较这些位）。
  - 例如，掩码为`b111111110000`（0xFF0）。

- **比较过程**

  - 将掩码应用于监视地址（例如，0x100）和写地址（例如，0x104）。
  - 如果掩码后的结果匹配（例如，两者都为 0x100），系统会认为写操作与监视地址重叠，独占写失败。

- **误报（False Negatives）**
  - 这种方法可能会保守地标记独占写为失败，即使写操作实际上没有修改监视的地址（例如，0x104–0x10B 不包括 0x100）。
  - 这种“误报”优先考虑安全性而非精确性，确保不会写入不一致的数据。

#### 示例解析（示例 2-1）

- **独占读**：一个主控器读取地址 0x100，并将其标记为监视。
- **干扰写**：另一个主控器写入 0x104–0x10B（一个 2 个 WORD 的突发写）。
- **独占写**：第一个主控器尝试写入 0x100。
- **监控过程**
  - 写范围 0x104–0x10B 的变化最高位为位 3。
  - 掩码：`b111111110000`（0xFF0）。
  - 监视地址：`0x100 & 0xFF0 = 0x100`。
  - 写地址：`0x104 & 0xFF0 = 0x100`。
  - 结果：匹配，因此独占写失败，尽管 0x100 实际上未被写入。

#### 突发类型处理

- 系统在计算写访问的地址范围时，始终将突发类型视为**INCR**（递增）。
- 这种保守的方法确保了安全性，即使实际突发类型为**WRAP**（环绕）或**FIXED**（固定），系统也会假设可能的最大地址范围，以防止遗漏边缘情况。

#### 重要性

独占访问在多主控系统中至关重要，可以防止竞争条件。例如：

- 一个处理器读取地址 0x100 的计数器（值为 5），并打算将其递增到 6。
- 如果没有独占访问，另一个处理器可能在第一个处理器写入 6 之前将 7 写入 0x100，导致数据不一致。
- 有了独占访问，系统会检测到第二个写操作，并使第一个处理器的写操作失败，促使其重试操作。

#### 总结

独占访问提供了一种强大的、硬件支持的方法，确保共享内存系统中的数据一致性。通过使用监视器和保守的地址比较，系统保证了安全的行为，即使偶尔会出现误报，也使其成为复杂并发环境中的理想同步机制。

### 关键要点

- 研究表明，通过 AXI 的 SRAM 内存访问涉及标准操作如读和写，同时对芯片选择和独占访问有特定处理。
- 内存地址移位似乎将 AXI 的字节地址与 SRAM 的字大小对齐，这对配置访问有影响。
- 证据倾向于认为突发对齐对分页内存至关重要，具有可编程选项以提升性能。
- 突发长度似乎可编程，但受 FIFO 深度的限制，影响传输效率。
- 从 SRAM 启动得到支持，最低的芯片可用于初始执行。

#### 标准 SRAM 访问

AXI 接口将内存呈现为一个连续的平面空间，支持读、写和独占访问。芯片选择通过上层地址位、掩码和预定义值确定。如果没有选择芯片，则进行默认传输，并返回“OKAY”响应。独占访问用于原子操作，成功时返回“EXOKAY”，失败时返回“OKAY”。

#### 内存地址移位

AXI 地址是字节对齐的，但 SRAM 通常使用更宽的字大小（如 16 或 32 位）。地址必须移位以与 SRAM 的字大小对齐，这在配置寄存器访问期间至关重要。

#### 内存突发对齐和长度

突发对齐确保传输与内存边界对齐，提升分页内存如 SRAM 的性能，具有可编程的 burst_align 选项。突发长度可从 1 到 32 节编程或连续，但受 FIFO 深度的限制，有特定的读写公式。

#### 从 SRAM 启动

SMC 支持从最低 SRAM 芯片（通常是芯片 0）启动，在启动期间映射到地址 0x0，定时寄存器设置为慢速内存。

---

### 详细分析：AXI 接口中 SRAM 内存访问

本节提供通过 AXI（高级可扩展接口）接口访问 SRAM（静态随机存取存储器）的全面分析，基于提供的技术文档。重点包括标准访问、内存地址移位、突发对齐、突发长度和从 SRAM 启动，并附加上下文以确保技术与非技术受众的清晰理解。

#### SRAM 和 AXI 的背景

SRAM 是一种只要供电就保留数据的内存类型，由于没有刷新周期，比 DRAM 更快。通常用于嵌入式系统中的缓存或启动，速度至关重要。AXI 接口是 AMBA（高级微控制器总线架构）规范的一部分，是 ARM 系统中用于连接处理器到外设的高性能总线协议，包括内存。它支持广泛的操作，如读、写和独占访问，这些对多核系统中的原子操作至关重要。

文档详细描述了如何通过 AXI 访问 SRAM，重点是程序员的视图和特定管理内存操作的机制。本分析将分解每个方面，并结合额外资源以增强理解。

#### 标准 SRAM 访问

从 AXI 程序员的角度看，内存呈现为一个连续的平面地址空间。这种抽象简化了编程，允许线性地址访问，无需了解内存设备的物理组织。AXI 接口支持：

- **读和写**：基本内存操作用于数据传输。
- **独占访问**：用于原子操作，确保自上次读取以来内存位置未被修改，这对多线程环境中的同步至关重要。

芯片选择机制确定访问哪个内存设备（或“芯片”）。这是基于地址的上 8 位（读为 araddr[31:24]，写为 awaddr[31:24]），与 address_mask 的值掩码后与 address_match 比较。例如，如果 address_mask 是 0xFF000000 且 address_match 是 0x00000000，则上 8 位为 0x00 的任何地址将选择芯片 0。这种映射确保每个地址范围对应于特定内存设备，防止重叠，否则系统内存控制器（SMC）的行为未定义。

如果地址未映射到任何配置的芯片选择，SMC 在内存接口 0 上执行默认异步传输，所有芯片选择都未断言。然后，它向 AXI 总线响应“OKAY”，表示传输完成，尽管实际上未访问任何内存。这种行为确保系统对未映射地址保持稳定。

独占访问对原子操作尤为重要。如果成功（即自上次读取以来内存位置未更改），响应为“EXOKAY”；否则为“OKAY”，表示访问失败。这符合 AMBA AXI 协议 v1.0 规范，确保与标准实践兼容。

文档中提到，信号如 arcache、awcache、arprot 和 awprot 包含在 AXI 接口中仅为完整性，但 SMC 不使用这些信号传输的信息。这些信号与缓存属性和保护相关，不影响 SRAM 访问，简化了此上下文的接口。

#### 内存地址移位

AXI 地址是字节对齐的，意味着每个地址指向单个字节，这是现代处理器的标准。然而，SRAM 设备通常具有更宽的数据总线，如 16 位或 32 位，意味着以较大块（字）访问内存。为了正确接口，呈现给 SRAM 的地址必须与其字大小对齐。

例如，如果 SRAM 是 16 位宽，地址必须右移 1 位（除以 2），因为 SRAM 以 16 位字而非字节看待地址。这种移位是必要的，因为 AXI 的字节对齐寻址必须转换为 SRAM 的字对齐寻址。文档强调，这在内存设备初始配置期间至关重要，特别是当通过特定地址序列访问内存模式寄存器时。程序员必须考虑此移位以定位正确的内存位置，确保适当的设置和操作。

#### 内存突发对齐

突发访问允许在单个操作中传输多个数据字，通过减少单个事务的数量来提高效率。然而，一些内存设备，特别是具有页面模式的如异步页面模式 SRAM 或同步 PSRAM（伪 SRAM），如果突发与内部页面边界对齐，性能更好。跨越页面边界可能导致性能惩罚，因为内存需要切换页面。

SMC 提供可编程选项 burst_align，由 opmode 寄存器控制。启用时，burst_align 确保内存突发与内存的突发边界对齐。如果 AXI 突发会跨越边界，SMC 将其分区为多个内存突发，每个在边界处终止。这适用于具有内部页面的内存，确保通过避免边界跨越优化性能。

文档指出，页面大小必须是突发长度的整数倍，以防止启用 burst_align 时内存突发跨越页面边界。此要求对维持效率至关重要。

当 burst_align 禁用时，SMC 在将 AXI 命令映射到内存命令时忽略内存突发边界。此设置适用于如 NOR 闪存等设备，这些设备没有页面的概念，允许连续突发无需对齐关注。

额外资源，如 AMD AXI 外部内存控制器文档 ([AXI External Memory Controller](https://www.amd.com/en/products/adaptive-socs-and-fpgas/intellectual-property/axi_emc.html))，确认支持突发传输，长度从 1-256 节为 INCR 突发，2、4、8、16 节为 WRAP 突发，与描述的可编程性质一致。

#### 内存突发长度

突发长度，确定在突发中传输多少数据节，可按单个芯片基础从 1 到 32 节编程或设置为连续突发。此灵活性允许针对不同内存设备和访问模式优化。

然而，实际突发长度受 SMC 的 FIFO（先进先出缓冲区）深度的限制，这些缓冲区在传输期间作为临时数据存储：

- **读传输**：最大突发长度等于读数据 FIFO 的深度。例如，如果 FIFO 可容纳 16 节，突发不能超过 16 节读。
- **写传输**：最大突发长度更复杂，取决于：
  - asize：AXI 传输大小，确定节大小（例如，4 字节传输为 2）。
  - mw：内存数据总线宽度（例如，16 位内存为 4）。
  - wfifo_depth：写数据 FIFO 的深度。

提供的公式为：

$$
内存写突发长度=(1≪asize)×wfifo_depth(1≪mw)\text{内存写突发长度} = \frac{(1 \ll \text{asize}) \times \text{wfifo\_depth}}{(1 \ll \text{mw})}内存写突发长度=(1≪mw)(1≪asize)×wfifo_depth​
$$

此计算确保 SMC 不尝试传输超过其缓冲区可处理的数据，防止溢出并维持系统稳定性。

#### 从 SRAM 接口启动

SMC 启用最低 SRAM 芯片选择，通常为芯片 0，可启动，这对需要立即执行代码的系统至关重要。要从 SRAM 启用启动，除了知道相关内存宽度外，不需要特殊功能，这由顶层固定信号 (sram*mw*<x>[1:0]) 指示。

在启动过程中，当 remap\_<x> 信号为高时，具有可启动芯片选择的内存映射到基地址 0x0。这允许处理器从 SRAM 开始执行代码，促进快速初始化。此外，定时寄存器重置为最坏情况值，以确保与最慢内存的兼容性，确保不同硬件配置的可靠性。

此功能在嵌入式系统中特别有用，初始代码需要存储在快速内存如 SRAM 中以快速启动，特别是在访问较慢或更复杂的内存如闪存之前。文档强调，在启动期间，系统确保 SRAM 接口就绪，除了内存宽度配置外无额外复杂性。

#### 比较分析和额外见解

为了增强理解，查阅了额外资源，如 Synopsys IP 技术公告关于连接 SRAM 到 AXI ([Connecting a Standard SRAM Device to an AMBA 3 AXI Subsystem](https://www.synopsys.com/dw/dwtb.php?a=sram_to_axi))，讨论使用 DesignWare Generic Slave (DW_axi_gs) 进行高效接口，消耗不到 4k 门。这确认了描述机制的可行性，DW_axi_gs 处理协议转换和信号映射，与芯片选择和突发对齐特征一致。

AMD AXI 外部内存控制器也支持 SRAM，具有如突发传输和窄/未对齐事务的特征，证实了可编程突发长度和对齐选项。这些资源强调了 AXI-SRAM 接口的行业标准实践，强化了文档的细节。

#### 关键特征总结表

| **特征**         | **描述**                                            |
| ---------------- | --------------------------------------------------- |
| **标准访问**     | 平面内存视图，支持读/写/独占，芯片选择通过地址位。  |
| **地址移位**     | 将 AXI 字节地址与 SRAM 字大小对齐，对配置至关重要。 |
| **突发对齐**     | 可编程 burst_align 适用于分页内存，在边界分割突发。 |
| **突发长度**     | 可编程 1-32 节或连续，受 FIFO 深度限制。            |
| **从 SRAM 启动** | 最低芯片可启动，映射到 0x0，定时设置为慢速内存。    |

此表总结了关键方面，为理解系统操作提供快速参考。

总之，文档提供了通过 AXI 访问 SRAM 内存的详细视图，具有标准操作、地址对齐、突发管理和启动的机制，所有这些都得到行业标准实践和额外资源的支持。此分析确保了实施和教育目的的彻底理解。


Start
Write timing parameters and operating mode to the memory controller holding registers.
Write required external chip select number and required mode register value to the direct_cmd Register.
The SMC passes this mode register command to the memory interface. The APB interface does not accept any more configuration commands until this command has been issued to the memory and the operating registers have been updated.
The memory interface continues passing commands to the memory device until a match in the data is made with the programmed match value.
Write the required memory mode register value(s) using the AXI interface.
When the match value is detected, no further commands are passed to that memory device until the operating registers have been updated.
When the final mode register command has been issued to the memory device, enabling the operating registers to be updated, the memory interface starts to operate in the new mode of operation.
In addition, the APB configuration registers can be programmed for the next memory device.
End


