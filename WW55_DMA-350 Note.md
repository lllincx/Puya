## 3. DMA-350 概览

CoreLink DMA-350 是一款带有 AMBA® AXI5 接口的直接存储器访问控制器（DMAC）。1 它能够在多个通道上提供快速的存储器到存储器、外设到存储器、存储器到外设以及外设到外设的复制能力。

系统中的处理器可以通过 APB4 接口控制 DMA 通道行为，并在支持安全扩展（Security Extension）时设置安全相关参数。该 DMAC 针对不同类型的复制、离散-集中（scatter-gather）、增量或二维图像复制操作进行了配置。它还支持用于流控制和命令序列化能力的触发输入与输出。DMA-350 通过 LPI 接口增加了对时钟和电源低功耗集成的支持。

DMA-350 可以拥有多个通道，这些通道可以具有不同的属性（如 FIFO 大小）以适应不同的需求。通过命令链接（command linking）功能，可以将多条 DMA 命令组合在一起。利用命令链接功能，可以设置复杂的传输任务，且 DMAC 可以在无需处理器交互的情况下执行。每个 DMA 通道都可以拥有一个连接到外部数据处理单元（DPU）的流接口（AXI4-Stream）。在 DMAC 将数据写入目的地之前，这些通道可以对获取的数据执行所需的数据处理任务。

下图展示了系统中的 DMA-350：

![image.png|600](https://lincx-img.oss-cn-shanghai.aliyuncs.com/img/20260105143202182.png)

### 3.1 组件概览

下图展示了 DMA-350 的顶层组件框图：

![image.png|600](https://lincx-img.oss-cn-shanghai.aliyuncs.com/img/20260105144020746.png)

DMA-350 包含以下主要模块：

**Control（控制模块）**

- 接收并终止来自处理器的 APB4 总线。
- 将寄存器访问转发至各个通道。
- 实现 DMAC 的公共控制功能。
- 处理通道的安全（Security）与特权（Privilege）访问权限设置。
- 针对高层级 DMAC 事件产生中断。

**DMA Channel（DMA 通道模块）**

- 实现 DMA 控制器的一个功能单元，能够发起存储器传输。
- 根据当前命令的设置产生 AXI 传输。
- 终止来自外设的触发接口（Trigger Interface）。
- 针对通道内部事件产生中断和触发输出（Trigger Out）指示。
- 实现内部 FIFO，用于隔离通道的读写两侧。
- 支持通过 AXI4-Stream 接口连接外部数据处理单元（DPU）。
- DMA-350 中可存在多个 DMA 通道，具体数量由配置参数决定。

**BIU（总线接口单元）**

- 负责在 DMA 通道与一个或两个下游 AXI5 管理器（Manager）接口之间进行流量路由与仲裁。

**TRIG MTX（触发矩阵模块）**

- 在 DMA 通道的触发输入/输出端口与顶层触发输入/输出端口之间实现可选择的连接。
- 允许通道间进行内部触发。

**QCTRL（电源与时钟管理）**

- 实现 DMA-350 的时钟与电源管理特性。
- 终止 LPI 接口，并根据内部活动状态允许进入静默（Quiescence）状态。

## 3.2 合规性

DMA-350 接口符合以下 Arm 规范和协议：

- AMBA AXI5 协议，参见 AMBA® AXI and ACE Protocol Specification
- AMBA APB4 协议，参见 AMBA® APB Protocol Specification
- AMBA AXI4-Stream 协议，参见 AMBA® AXI-Stream Protocol Specification
- AMBA 低功耗接口（LPI）协议，参见 AMBA® Low Power Interface Specification

## 3.3 关键特性

DMA-350 支持以下关键特性：

- 可编程 APB4 配置寄存器
- AXI5 数据路径
- 用于时钟和电源的低功耗接口（LPI）
- 1-8 个并行 DMA 通道，每个通道带有可配置的 FIFO
- 包含地址增量的 1D 存储器复制
- 每个通道的中断能力及全局事件中断
- 灵活的命令链接（Command Linking）能力
- 用于流控制的触发能力
- 扩展存储器复制能力：2D/回环（Wrap）/模板（Template）
- 扩展接口

## 3.4 可配置选项

DMA-350 可以通过以下选项进行配置以满足特定的设计需求。括号内包含相关的配置参数，这些参数在 Arm® CoreLink™ DMA-350 Controller Configuration and Integration Manual 中有详细描述：

- AXI5 地址位宽：32 位或 64 位 (ADDR_WIDTH)
- AXI5 数据位宽：32 位、64 位或 128 位 (DATA_WIDTH)
- 通道识别寄存器位宽：0 位至 16 位 (CHID_WIDTH)
- 通道通用输出（GPO）位宽：0 位至 32 位 (GPO_WIDTH)
- 通道的 GPO 支持情况 (CH_GPO_MASK)
- 通道的 Stream 支持情况 (CH_STREAM_MASK)
- 每个通道独立的 FIFO 深度：1, 2, 4, 8, 16, 32, 64 (CH\_<N>\_FIFO_DEPTH)
- 通道的扩展特性支持（2D、回环、模板）(CH_EXT_FEAT_MASK)
- DMA 通道数量：1 至 8 个 (NUM_CHANNELS)
- 触发输入端口数量：0 至 32 个 (NUM_TRIGGER_IN)
- 触发输出端口数量：0 至 32 个 (NUM_TRIGGER_OUT)
- 触发输入端口同步 (TRIG_IN_SYNC_EN_MASK)
- 触发输出端口同步 (TRIG_OUT_SYNC_EN_MASK)
- 是否存在第二 AXI5 管理器端口 (AXI5_M1_PRESENT)
- 是否存在用于 TrustZone® 支持的安全扩展 (SECEXT_PRESENT)

## 3.5 产品文档与设计流程

本节描述了与设计流程相关的 DMA-350 文档。

### 3.5.1 文档

DMA-350 文档如下：

技术参考手册 (TRM)

技术参考手册（TRM）描述了功能以及功能选项对 DMA-350 行为的影响。它在设计流程的所有阶段都是必需的。设计流程中所做的选择可能意味着 TRM 中描述的某些行为并不适用。

如果您正在对 DMA-350 进行编程，请联系：

- 实现者（Implementer）以确定：
  - 构建配置的实现情况。
  - 在实现 DMA-350 之前执行的集成操作（如果有）。
- 集成者（Integrator）以确定所用设备的引脚配置。

配置与集成手册 (CIM)

配置与集成手册（CIM）描述了：

- 可用的构建配置选项以及选择这些选项时的相关问题。
- 如何将 DMA-350 集成到 SoC 中。该部分描述了集成者在连接系统接口时需要考虑的事项。
- 签署（Sign off）设计配置、集成和实现的过程。
  CIM 是机密文档，仅对授权许可持有者开放。

### 3.5.2 设计流程

DMA-350 以可综合 RTL 形式交付。在用于产品之前，必须经过以下过程：

实现 (Implementation)

实现者配置并综合 RTL 以生成软网表（soft netlist）。

集成 (Integration)

集成者将实现后的设计连接到 SoC 中。集成包括将设计连接到存储系统和外设。

# 4. DMAC 接口

本节包含 CoreLink DMA-350 接口的概览。

## 4.1 时钟与复位

DMA-350 旨在放置在单一时钟和复位域中。

APB4 配置接口和 AXI5 管理器接口（M0 和 M1）使用时钟使能信号，以支持这些接口在分频频率下运行。APB 配置接口使用 pclken 信号，M0 接口使用 aclken_m0 信号，M1 接口使用 aclken_m1 信号。

可选的 AXI4-Stream 管理器和从属接口没有时钟使能信号，它们直接使用模块时钟。

DMA-350 使用单一的低电平有效复位信号 resetn。该复位必须与 clk 时钟信号同步释放，但可以异步置位。

DMA-350 没有定义特殊的上电要求。

## 4.2 APB4 从机接口

APB4 从机接口用于访问 DMA-350 的内部配置寄存器。

DMA-350 支持 AMBA APB4 协议规范。有关更多信息，请参见 AMBA® APB Protocol Specification 文档。

寄存器访问

仅支持 32 位宽度的访问。当 APB4 写访问使用的 pstrb 不是 4'b1111 时，会导致错误响应。非对齐访问通过在内部将 paddr[1:0] 固定为 0，从而被视为正常访问。

### 4.2.1 APB4 保护

APB4 寄存器空间中的某些寄存器受保护，仅供高特权级和安全软件模块使用。这些寄存器配置 DMAC 的整体行为，并通过检查访问的特权和安全属性在 DMAC 内部受到保护。

特权保护

在访问具有更高特权权利的寄存器时，DMAC 会检查 pprot[0] 位。当访问被拒绝时，DMAC 返回 RAZ/WI。

安全保护

通过在访问具有更高安全权利的寄存器时检查 pprot[1]，DMAC 支持安全扩展（Security Extension）。当访问违反安全规定时，DMAC 根据软件配置寄存器返回 RAZ/WI 或错误响应，并且如果使能了中断，还可能产生中断。

### 4.2.2 APB4 PWAKEUP

APB4 接口通过 **pwakeup** 端口扩展了时钟唤醒信号。当 **pwakeup** 源自寄存器源时，这允许更快的时钟请求机制。该信号用于指示存在与 APB4 接口相关的持续活动。如果该信号不是 APB4 接口的一部分，可以将 **psel** 信号寄存化以生成 **pwakeup** 信号。

### 4.2.3 APB4 PDEBUG

APB4 接口具有一个侧带信号，允许调试器在非安全模式下扫描内存范围时访问 DMAC 而不产生副作用。当调试器发起 APB4 访问时，可以将此信号置高，从而禁用安全违规错误和中断生成，同时通过响应 RAZ/WI 继续保护安全寄存器。该信号在访问的 2 个周期内必须保持稳定。

## 4.3 AXI5 管理器接口

DMAC 是一个 AXI5 管理器，符合 AMBA AXI5 协议，具有缩减的 AXI5 特性集。有关协议的详细信息，请参见 AMBA® AXI and ACE Protocol Specification。AXI5 管理器接口用于由 DMA 通道生成的读写数据传输。

DMAC 上始终存在一个 AXI5 管理器接口。还可以通过使用配置参数 AXI5_M1_PRESENT 添加一个额外的 AXI5 接口。

### 4.3.1 突发类型（仅限 FIXED / INCR）

DMA-350 通过仅发送 FIXED 和 INCR 突发来降低复杂度。

FIXED 突发用于目标是带有 FIFO 的外设且多次访问同一地址的情况。这可以通过将增量值设置为 0 来实现。

INCR 突发用于所有其他情况，且突发长度受 \*MAXBURSTLEN 寄存器设置限制。如果 DMAC 在某些点连接到 AHB 互连，这也能降低将 AXI5 传输转换为 AHB 的复杂度。

### 4.3.2 ID 生成

**AxID** 的生成由 DMAC 按通道自动完成。读写传输使用标识通道的 **AxID**。命令链接也使用通道自身的 ID 从存储器中获取命令，但带有一个指示命令访问的额外侧带信号。可以通过使用 **CHID** 寄存器添加基于软件的通道 ID 设置，以辅助 DMAC 外部的内存映射。这些寄存器作为用户信号（User signals）存在于总线上，DMAC 内部不使用它们。

### 4.3.3 W 传输生成

**WDATA** 在 **AW** 通道传输的同时或之后发送到总线上。**WDATA** 不会赶超（overtake） **AW** 控制信息，因为这会增加仲裁逻辑的复杂度。如果传输大小设置为小于总线数据宽度，则使用 **Strobe**（选通）信号。

### 4.3.4 发起能力

读发起能力受每个通道独立 FIFO 深度的限制，可选值为 1, 2, 4, 8, 16, 32, 64。通道只有在有足够空间存储完整的读响应时才会发起读操作。

写发起能力取决于传输大小和存储在通道内部 FIFO 中的数据。当 FIFO 包含带有所有节（beats）的完整突发时，发起写操作。

发起的传输数量取决于命令类型和地址对齐情况。

最大发起能力受 DMA 单元限制，以避免 AXI 基础设施因过多的在途（outstanding）传输而过载。软件可以控制总线上的在途传输数量。如果总线仍然过载，这可以实现调试和总线利用率整形。

### 4.3.5 响应处理

AXI 访问可能导致成功或不同的错误响应。错误响应会被路由到特定通道，该通道进入错误状态，而其他通道继续运行。

### 4.3.6 AXI 带宽利用率

本节提供术语定义和优化要求。

**术语定义**

突发断点 (Burst breakpoint)

AXI5 突发不能跨越的边界。这些边界可以是以下内容：

- **1KB 地址边界**：DMA-350 绝不跨越 1KB 地址边界（支持 AHB 要求）。
- **触发块结束**：流触发请求允许访问一个触发块。一旦访问完成，需要新的触发请求才能访问任何后续数据，因此 AXI5 突发不能超出触发块。
- **FIFO 大小/2**：限制单次突发传输的数据量。
- **MAXBURST 寄存器设置**：限制突发长度（**axlen**）：突发必须短于此用户指定值。

非对齐起始 (Unaligned start)

AXI5 事务访问的第一个字节不是总线的 LSB 字节通道。

非对齐结束 (Unaligned end)

AXI5 事务访问的最后一个字节不是总线的 MSB 字节通道。

DMA-350 有两种模式来确定其 AXI5 突发节的大小（**axsize**）：

未优化 (Unoptimized)

无论总线宽度如何，节大小与 DMA 命令中设置的大小相同。

优化 (Optimized)

为了优化窄传输的总线利用率，在可能的情况下将它们分组为更宽的访问。AXI5 协议规范为读侧和写侧提供了不同的可能性。

- 对于写侧，节大小与总线宽度相同，使用写选通（write strobes）从写操作中排除未访问的字节通道。
- 对于读侧，对于具有对齐结束的 AXI5 事务，节大小与总线宽度相同。具有非对齐结束的 AXI5 事务可能只能部分优化。参见“非对齐起始地址示例”和“非对齐结束地址示例”中的示例。

**优化要求**

- AXI5 突发目标必须是 **Normal Memory** 类型（非 Device 类型）。
- 当前侧的当前 DMA 命令必须禁用 **Template** 特性。
- 当前侧的当前 DMA 命令的地址增量必须为 1。
- 读操作：
  - AXI 事务要么包含足够的数据以达到总线对齐，要么具有对齐的起始地址。
  - 如果起始地址对齐，但数据不足以访问总线上的所有字节，则使用在 DMA 命令定义的地址空间内最大的可能 **arsize**。

### 4.3.9 传输属性

传输的存储器属性（Memory attributes）可以通过每个命令的软件可配置寄存器进行调整。安全和特权设置可以针对安全或特权通道进行调整。读侧和写侧可以分别选择设备（Device）或存储器（Memory）类型。缓存策略（Cacheability）和共享属性（Shareability）值也可以进行设置，以匹配 DMA 传输目标内存位置的设置。这些设置必须与系统中其他组件定义的值相匹配，并会影响每次传输的性能。

与命令链接（Command link）相关的读取始终作为指令类型传输发送，即 `arprot[2]` 驱动为 1。命令链接访问继承通道的安全和特权设置。

### 4.3.10 额外 AXI 信号

AXI 支持多种对 DMAC 运行而言可选的特性：

- **axsize** 信号受数据总线宽度的最大值限制，因此如果 DMAC 驱动的是 64 位或更窄的总线，则可能不会使用最高有效位（MSB）。
    
- 不使用 **axlock** 信号，因为 DMAC 不会生成独占（exclusive）或锁定（locked）传输。
    
- **axinner** 信号指示读写事务的内部域（inner domain）缓存属性。
    
- **axchid** 和 **axchidvalid** 信号指示软件可配置的通道 ID。
    
- **arcmdlink** 信号指示当前的读操作是命令链接读取。
    
- **awakeup** 信号在两个管理器接口上均由寄存器驱动，用于唤醒 AXI 数据路径中的设备。
    
- **axdomain** 信号增加了最小限度的 ACE5-Lite 兼容性。
    

### 4.3.11 可配置的第二 AXI5 端口

当通过配置参数启用时，DMA-350 支持一个额外的完整 AXI5 管理器端口。这使得连接到系统的其他部分更加容易，而无需互连矩阵（Interconnect）。次要端口还允许在两个接口上并行进行读写操作。

两个 AXI5 管理器端口使用相同的属性，例如数据宽度和发起能力。两个端口都与模块时钟同步，同时拥有各自的时钟使能信号。

当使用两个 AXI5 管理器端口时，DMA-350 必须能够根据给定的地址决定应将其转发到 `AXI5_M0` 还是 `AXI5_M1` 管理器端口。在一个实现者可编辑的文件中提供了一个用于此目的的 SystemVerilog 函数。交付的 IP 包中包含了一个用于此目的的示例文件。

有关详细信息，请参阅《Arm® CoreLink™ DMA-350 控制器配置与集成手册》中的 AXI5 管理器端口地址映射章节。

## 4.4 触发接口

触发接口（Trigger Interfaces）可用于控制 DMA 通道操作与其他外设之间的交互。

外部外设或设备可以通过触发输入接口控制 DMA 命令的执行。DMAC 也可以通过其触发输出接口控制外部外设。

触发输入和触发输出接口相互兼容。由于这种兼容性，也可以在 DMAC 内部将两个 DMA 通道连接在一起，或者通过串联多个 DMA 控制器进行连接。

除了硬件触发接口外，还通过通道控制寄存器提供软件触发接口，使软件能够与触发机制进行交互。

### 4.4.1 触发输入接口

触发输入接口可以同步 DMA 命令与外设的操作。外设可以在命令或命令的一部分可以开始时通知 DMA-350。

该接口由简单的四相握手（4-phase handshake）以及定义当前请求和确认对类型的附加限定符总线信号组成。该接口定义为易于与现有的触发接口类型兼容。当接口跨不同的异步时钟域使用时，四相握手还允许简单的时钟域切换（CDC）结构。

### 4.4.2 触发输入接口信号

当外设将 **req** 信号拉高时，表示 DMAC 可以开始其命令或命令的一部分。DMAC 通过将 **ack** 置高来确认收到 **req**。

**req** 和 **ack** 信号都带有附加的限定符信号。这些信号为接收实体提供额外信息。

利用 **reqtype[1:0]** 信号，外设可以向 DMA-350 提供更详细的信息。DMAC 使用 **acktype[1:0]** 信号在发送 **ack** 的同时向外设提供更多信息。

### 4.4.3 触发输出接口

触发输出接口可以通知连接的外设 DMA-350 已完成一项命令。

该接口由简单的四相握手组成。该接口定义为易于与现有的触发接口类型兼容。当接口在不同的异步时钟域上使用时，四相握手还允许简单的时钟域切换结构。

### 4.4.4 触发输出接口信号

DMA-350 通过将 **req** 信号拉高，向外部外设发出命令已达到最终状态的信号。外设必须通过将 **ack** 信号拉高来确认收到此信息。在收到此确认之前，DMA 命令的执行尚未完成，这为 DMA-350 和外设之间提供了一个同步点。

## 4.5 AXI4-Stream 接口

每个 DMA 通道都可以拥有一个专用的 AXI4-Stream 接口，以使外部引擎能够对通过 DMAC 传输的数据进行处理。启用后，在 AXI 上读取的所有数据都会被推送到 Stream 接口。外部引擎预计会进行数据处理，处理结果可能是消耗数据、保持相同数据量、甚至生成更多数据元素。转换完成后，数据通过 Stream 输入接口发回 DMAC，并最终在 AXI 写侧写出。

Stream 接口预计将简单地连接到外部引擎，因此不涉及互连相关的侧带信号或空传输。Stream 接口符合 AMBA® AXI-Stream 协议规范，并使用数据传输所需的 AXI4-Stream 信号缩减集。

限制与扩展

接口数据宽度与 AXI 读写通道的数据宽度匹配，这意味着转换可以在 DMAC 外部完成。Stream 接口还支持连续的对齐和非对齐流。DMAC 不会发送稀疏流（sparse streams），也不接受从外部引擎接收的稀疏流。除断言 tlast 时外，tstrb 信号必须全部为 f，这限制了非对齐流仅在末尾拥有选通信号。

不支持空字节（Null bytes），接口上不存在 **tkeep** 信号。

在 `stream_in` 接口上存在一个额外的 **flush** 侧带输出信号。由于命令提前结束，该信号作为一个提示，要求外部引擎提供 **TLAST**。

## 4.6 LPI 接口

DMAC 通过用于时钟和电源的 LPI 接口增加对低功耗集成的支持。Q-Channel 接口为时钟提供静默（quiescence）能力，P-Channel 接口在 DMAC 处于空闲（IDLE）且无活动进行时允许进行电源管理。DMAC 可以通过活动指示信号请求电源和时钟。DMAC 根据其当前的内部状态接受或拒绝电源和时钟控制器的请求。

### 4.6.1 LPI 电源 P-Channel

电源 P-Channel 接口用于向 DMAC 请求电源静默。电源控制器驱动请求，而 DMAC 根据其当前内部状态接受或拒绝请求。DMAC 还可以通过 **pactive** 信号为某项活动请求电源。**pactive** 支持从“关闭（Off）”到“热复位（Warm reset）”的 10 位位宽活动指示。然而，DMAC 仅断言“关闭”、“全保持模式（Full retention mode）”和“开启（On）”指示。

DMAC 不旨在支持强制电源关断。当发生请求且活动正在进行时，DMAC 只是简单地拒绝请求并继续运行。除 P-Channel 握手外，该请求对操作没有影响。

### 4.6.2 LPI 时钟 Q-Channel

时钟 Q-Channel 接口用于向 DMAC 请求时钟静默。时钟控制器驱动请求，而 DMAC 根据其当前内部状态接受或拒绝请求。DMAC 还可以通过 **qactive** 信号为某项活动请求时钟。

DMAC 不旨在支持强制时钟关闭。当发生请求且活动正在进行时，DMAC 只是简单地拒绝请求并继续运行。除 Q-Channel 握手外，该请求对操作没有影响。

## 4.7 DMA 中断

中断指示 DMA 通道以及 DMA 单元内部状态的变化。每个通道都有自己独立的中断。始终存在一个全局非安全中断，此外，当启用 TrustZone 支持时，还会出现一个全局安全中断和一个安全违规中断。中断是电平触发信号。

## 4.8 控制与状态接口

控制与状态接口使系统能够控制 DMAC 的运行（停止和暂停），并提供 DMAC 运行的状态信息。

### 4.8.1 通用输出

通用输出（GPO）端口提供了额外的位，您可以在整个 DMAC 运行过程中将其设置为稳定值。

您可以将 GPO 端口用于多种用途：

- 选择内存银行（Memory banks）
    
- 在调试引脚上指示通道运行
    
- 控制外部数据处理引擎等。
    

GPO 是按通道驱动的，因此每个通道都有自己的端口。

GPO 的值由软件控制。当 `ENABLE` 寄存器位置位时，输出值变为有效，并在 DMA 通道处于激活状态时保持稳定。当通道停止驱动 GPO 时，GPO 保持在命令设置的最后一个值。通过运行一个选择所有 GPO 并将其清零的空命令，可以将 GPO 设回初始值。

### 4.8.2 停止与暂停控制

**allch_stop** 信号可被外部硬件单元用于停止 DMAC 所有激活通道的运行。在处理系统中的错误情况且必须通过立即行动清除 DMAC 任务时，停止功能非常有用。停止操作会等待所有读写事务的在途（outstanding）响应，但它会通过不再发送更多请求且不再断言触发信号，尝试尽快结束通道操作。

这些信号由简单的四相握手组成。当 **allch_stop_req_nonsec** 被断言时，所有未处于空闲状态的非安全通道都会停止。软件可以启用通道，但当此请求被断言时，它们会立即停止。**allch_stop_ack_nonsec** 的断言表示所有非安全通道均已停止或处于不活跃状态。当启用安全选项（`SECEXT_PRESENT=1`）时，对于安全通道存在独立的信号 **allch_stop_req_sec** 和 **allch_stop_ack_sec**，它们仅作用于安全域中的通道。

通过由外部硬件单元操作的 **allch_pause** 信号，可以在某个时间点立即暂停 DMA 通道的运行。暂停功能对于将通道冻结在某种状态并检查其寄存器的当前值，或者暂停 DMA 单元片刻以释放总线基础设施资源非常有用。使能位保持断言状态，并且每个传输和触发状态都得到保留，不会丢失任何信息。

这些信号由简单的四相握手组成。当 **allch_pause_req_nonsec** 被断言时，所有未处于空闲状态的非安全通道都会暂停。软件可以启用通道，但当此请求被断言时，它们会立即暂停。当请求撤销（deasserted）时，运行继续。当 **allch_pause_ack_nonsec** 被断言时，所有非安全通道均已暂停或处于不活跃状态。当启用安全选项（`SECEXT_PRESENT=1`）时，对于安全通道存在独立的信号 **allch_pause_req_sec** 和 **allch_pause_ack_sec**。

### 4.8.3 交叉触发接口

DMAC 提供了一个交叉触发接口（CTI），允许一次性暂停和恢复所有通道。在为了调试目的而挂起处理器且调试器必须保存实际内存内容的系统中，CTI 是必需的，因此也可以暂停 DMAC 以避免损坏系统的当前状态。

该接口由挂起请求（**halt_req**）、重启请求（**restart_req**）以及显示 DMAC 是否已挂起的状态信号（**halted**）组成。

### 4.8.4 状态信号

这些信号指示各个通道的不同状态：

- **ch_enabled** 显示通道何时处于激活状态
    
- **ch_err** 显示通道何时遇到错误
    
- **ch_stopped** 显示通道何时被停止
    
- **ch_paused** 显示通道何时被暂停
    
- **ch_priv** 显示通道的特权设置
    
- **ch_nonsec** 显示通道的安全设置
    

## 4.9 配置接口

DMAC 的行为可以通过静态输入端口进行配置。静态输入端口来自于固定电平（tie-off）信号，或者由在 DMAC 释放复位时稳定且包含有效值的配置寄存器驱动。

### 4.9.1 自动启动接口

启动（boot）接口由以下信号组成：

- **boot_en** - 用于启用自动启动
    
- **boot_addr** - 启动命令描述符的地址
    
- **boot_memattr** - 获取启动命令描述符期间要使用的 AXI 存储器属性
    
- **boot_shareattr** - 获取启动命令描述符期间要使用的 AXI 存储器共享属性
    

**boot_en** 的断言表示启用了自动启动且其他信号有效。如果 **boot_en** 未被断言，则禁用自动启动且忽略其他启动信号。所有启动信号在撤销复位时必须保持稳定，并保持稳定直到开始获取启动命令。

有关自动启动的更多详细信息，请参阅“自动启动特性”章节。

---

# 5. DMAC 运行

本节包含 CoreLink DMA-350 运行的概览。

## 5.1 DMAC 运行概览

DMAC 可以通过寄存器写入进行配置，以执行各种命令。当软件完成寄存器设置和命令链接元素后，可以通过额外的寄存器写入来使能通道。这一步会使所有配置寄存器在软件侧变为只读。随后，DMAC 开始检查命令的有效性，并根据寄存器设置执行传输。

命令可以包含简单的存储器传输、离散-集中型（scatter-gather）传输、触发处理、通用输出、2D 存储器操作以及许多其他组合。当命令执行完毕时，DMAC 要么返回空闲状态，要么重新加载该命令，或者跳转到命令列表中的下一个项目。当 DMAC 返回空闲（IDLE）状态时，它可以产生中断和触发输出信号，以便将此事件与系统中的软件或其他硬件元件同步。当 DMAC 处于空闲状态时，可以再次配置寄存器。

DMAC 还具备检测存储器传输期间错误的能力。当接收到故障时，它会返回错误并停止运行。

## 5.2 DMAC 运行基本命令

本节包含 DMA-350 运行基本命令的概览。

### 传输类型 1D

传输类型 1D 是一种一维数据块传输。它按照配置的传输大小（Transfer size），将数据从源地址连续传输到目的地址。此模式是大块数据传输的典型用例，在 DMAC 传输过程中不需要进行数据格式化。

传输大小设置范围从字节到总线宽度，按 2 的幂次方递增。源端和目的端的传输大小相同。源地址和目的地址与传输大小对齐，因为根据 **TRANSIZE** 的值，低位地址位会在内部被忽略。要复制的传输数量以传输大小的增量来指定。软件还可以限制 DMAC 发送到总线的最大突发长度（Maximum burst length），以允许互连上的其他设备进行仲裁。


|**厂商 / IP (Vendor)**|**读写内存模式 (Read/Write Mem)**|**仅计算/APB模式 (Calc Only via APB)**|**备注 (Notes)**|
|---|---|---|---|
|**Synopsys** (DDR/MCTL)|**Inline ECC**|**Diagnostic Mode** / **ECC Poison**|Synopsys常把非内存路径的ECC操作归类为Diagnostic或Error Injection功能。|
|**ARM** (CoreLink/DMC)|**End-to-End ECC** / **Integrated**|**Syndrome Recording** / **UE/CE Capture**|ARM通常没有专门的"计算器模式"，而是通过Debug寄存器捕获(Capture)计算结果。|
|**Cadence** (Denali)|**Inline ECC**|**ECC Bypass** / **Loopback**|有时用Bypass指代绕过PHY直接在逻辑层处理数据的模式。|
|**NXP / TI** (Automotive)|**Functional Mode**|**Software Mode** / **Safety Diagnostic**|车规芯片常称通过寄存器手动计算ECC为"Software Mode"（指软件触发硬件计算）。|